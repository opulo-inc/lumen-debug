var m=Object.defineProperty;var y=(f,e,i)=>e in f?m(f,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[e]=i;var B=(f,e,i)=>(y(f,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();class w{constructor(){B(this,"delay",e=>new Promise(i=>setTimeout(i,e)));this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.port,this.receiveBuffer=[],document.getElementById("connect").addEventListener("click",()=>{this.connect()}),document.getElementById("send").addEventListener("click",()=>{this.sendRepl()}),document.getElementById("tmc").addEventListener("click",()=>{this.testTMC()}),document.getElementById("vac").addEventListener("click",()=>{this.testVac()})}getNextBufferLine(){return this.receiveBuffer.shift()}async clearBuffer(){for(;this.receiveBuffer.length>0;)this.receiveBuffer.shift()}async connect(){if(!navigator.serial)return!1;const e=1155;return this.port=await navigator.serial.requestPort({filters:[{usbVendorId:e}]}),console.log("Port Selected."),await this.port.open({baudRate:115200,bufferSize:255,dataBits:8,flowControl:"none",parity:"none",stopBits:1}),console.log("Port Opened."),this.listen(),document.querySelector("#connect").style.background="green",document.querySelector("#connect").style.color="white",document.querySelector("#connect").innerHTML="Connected",!0}async listen(){var e;for(;(e=this.port)!=null&&e.readable;){console.log("Port is readable: Starting to listen.");let i="",o=document.getElementById("console");const t=this.port.readable.getReader();try{for(;;){console.log("reading");const{value:n,done:a}=await t.read();if(a){console.log("closing reader");break}const c=this.decoder.decode(n);for(i=i.concat(c);i.indexOf(`
`)!=-1;){let r=i.split(`
`);this.receiveBuffer.push(r[0]),console.log(this.receiveBuffer.length);let s=document.createElement("p"),d=new Date().toISOString();s.innerHTML=d+" - "+r[0]+`
`,o.appendChild(s),o.scrollTop=o.scrollHeight,i=i.split(`
`).slice(1).join(`
`)}}}catch(n){console.error("reading error",n)}finally{t.releaseLock()}}}async send(e){var i;if((i=this.port)!=null&&i.writable){const o=await this.port.writable.getWriter();for(const t of e)console.log("Sending Line: "+t),await o.write(this.encoder.encode(t+`
`));o.releaseLock()}}async sendRepl(){let e=[document.querySelector("#repl-input").value];this.send(e)}async testTMC(){const e=["M122"];this.send(e)}async testVac(){const e=["M260 A112 B1 S1","M260 A109","M260 B48","M260 B10","M260 S1"],i=["M260 A112 B2 S1","M260 A109","M260 B48","M260 B10","M260 S1"];this.clearBuffer();let t,n,a;const c=new RegExp("data:(..)");await this.send(e),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let g=this.receiveBuffer[r];if(c.test(g)){t=g.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let l=this.receiveBuffer[r];if(c.test(l)){n=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let l=this.receiveBuffer[r];if(c.test(l)){a=l.match("data:(..)")[1];break}}let d=parseInt(t+n+a,16);console.log(d),this.clearBuffer(),await this.send(i),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let l=this.receiveBuffer[r];if(c.test(l)){t=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let l=this.receiveBuffer[r];if(c.test(l)){n=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var r=0,s=this.receiveBuffer.length;r<s;r++){let l=this.receiveBuffer[r];if(c.test(l)){a=l.match("data:(..)")[1];break}}let h=parseInt(t+n+a,16);console.log(h),console.log(d,h),alert("Left Sensor: "+d+", Right Sensor: "+h)}}new w;
