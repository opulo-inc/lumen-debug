var m=Object.defineProperty;var y=(f,r,i)=>r in f?m(f,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[r]=i;var B=(f,r,i)=>(y(f,typeof r!="symbol"?r+"":r,i),i);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}})();class w{constructor(){B(this,"delay",r=>new Promise(i=>setTimeout(i,r)));this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.port,this.receiveBuffer=[],document.getElementById("connect").addEventListener("click",()=>{this.connect()}),document.getElementById("tmc").addEventListener("click",()=>{this.testTMC()}),document.getElementById("vac").addEventListener("click",()=>{this.testVac()})}getNextBufferLine(){return this.receiveBuffer.shift()}async clearBuffer(){for(;this.receiveBuffer.length>0;)this.receiveBuffer.shift()}async connect(){if(!navigator.serial)return!1;const r=1155;return this.port=await navigator.serial.requestPort({filters:[{usbVendorId:r}]}),console.log("Port Selected."),await this.port.open({baudRate:115200,bufferSize:255,dataBits:8,flowControl:"none",parity:"none",stopBits:1}),console.log("Port Opened."),this.listen(),document.querySelector("#connect").style.background="green",!0}async listen(){var r;for(;(r=this.port)!=null&&r.readable;){console.log("Port is readable: Starting to listen.");let i="",a=document.getElementById("console");const e=this.port.readable.getReader();try{for(;;){console.log("reading");const{value:s,done:o}=await e.read();if(o){console.log("closing reader");break}const c=this.decoder.decode(s);for(i=i.concat(c);i.indexOf(`
`)!=-1;){let t=i.split(`
`);this.receiveBuffer.push(t[0]),console.log(this.receiveBuffer.length);let n=document.createElement("p"),d=new Date().toISOString();n.innerHTML=d+" - "+t[0]+`
`,a.appendChild(n),a.scrollTop=a.scrollHeight,i=i.split(`
`).slice(1).join(`
`)}}}catch(s){console.error("reading error",s)}finally{e.releaseLock()}}}async send(r){var i;if((i=this.port)!=null&&i.writable){const a=await this.port.writable.getWriter();for(const e of r)console.log("Sending Line: "+e),await a.write(this.encoder.encode(e+`
`));a.releaseLock()}}async testTMC(){const r=["M122"];this.send(r)}async testVac(){const r=["M260 A112 B1 S1","M260 A109","M260 B48","M260 B10","M260 S1"],i=["M260 A112 B2 S1","M260 A109","M260 B48","M260 B10","M260 S1"];this.clearBuffer();let e,s,o;const c=new RegExp("data:(..)");await this.send(r),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let g=this.receiveBuffer[t];if(c.test(g)){e=g.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let l=this.receiveBuffer[t];if(c.test(l)){s=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let l=this.receiveBuffer[t];if(c.test(l)){o=l.match("data:(..)")[1];break}}let d=parseInt(e+s+o,16);console.log(d),this.clearBuffer(),await this.send(i),await this.send(["M260 A109 B6 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let l=this.receiveBuffer[t];if(c.test(l)){e=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B7 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let l=this.receiveBuffer[t];if(c.test(l)){s=l.match("data:(..)")[1];break}}this.clearBuffer(),await this.send(["M260 A109 B8 S1"]),await this.send(["M261 A109 B1 S1"]),await this.delay(20),console.log("current buffer length: ",this.receiveBuffer.length);for(var t=0,n=this.receiveBuffer.length;t<n;t++){let l=this.receiveBuffer[t];if(c.test(l)){o=l.match("data:(..)")[1];break}}let u=parseInt(e+s+o,16);console.log(u),console.log(d,u),alert("Left Sensor: "+d+", Right Sensor: "+u)}}new w;
